class FenixClient{constructor(e,t=null,i=!1){this.styleToMaximize=null,this.styleToMinimize=null,this.arguments=e,this.container=null,this.currentLocation=window.location.href,this.window=window,this.createContainer(t,i),this.style(!1),this.start(),this.actions={close:"",minimize:"minimize",maximize:"maximize"},this.methods={close:this.hide.bind(this),minimize:this.minimize.bind(this),maximize:this.maximize.bind(this)},window.addEventListener("message",e=>{e&&e.data&&(console.log("[Fênix] Recebendo evento ...: ",e.data),e=this.actions[e.data],this.methods[e]&&this.methods[e]())}),this.events=[new EventListener("created-customer"),new EventListener("on-queue"),new EventListener("established-attendance"),new EventListener("finished-attendance"),new EventListener("rating"),new EventListener("close"),new EventListener("minimize"),new EventListener("maximize")]}setActions(e){this.actions={...this.actions,...e}}start(){if(!this.container)throw Error("Frame element is not started or not found");{var n=this.arguments,s="";if(!n||!n.creditor)throw Error("There's not enough arguments to open frame");var r=n.channel||"chat";switch(n.enviroment||"production"){case"production":s="https://fenixclient.servicesdigital.com.br";break;case"homologation":s="https://fenixhomolog.servicesdigital.com.br:82"}var o=n.creditor||undefined;let e=n.queue&&n.creditor?n.queue:undefined,t=n.subject&&n.queue?n.subject:undefined;var a=n.identifier&&n.subject?n.identifier:undefined;s+="/"+r+"/",s+=o||"",s+=e?"/"+e:"",s+=t?"/"+t:"",s+=a?"/"+a:"";let i=n.data&&n.identifier?n.data:undefined;i&&(s+="?",Object.keys(i).forEach(function(e){s+=e+"="+i[e]+"&"}),n.token&&(this.token=n.token,s+="&"==s.substring(s.lenght-1)?"token="+n.token:"&token="+n.token),n.origin&&(s+="&"==s.substring(s.lenght-1)?"entry_point="+n.origin:"&entry_point="+n.origin)),this.frame.setAttribute("src",s),this.frame.addEventListener("load",()=>{this.sendMessage(e,t)},!1)}}style(i=null){let n=this.container;if(!n)throw Error("Frame element is not started or not found");i&&(Object.keys(i).forEach(function(e,t){n.style[e]=i[e]}),this.currentStyle=i),this.frameState()}display(){let e=this.container;if(!e)throw Error("Frame element is not started or not found");e.style.display="block",sessionStorage.setItem("frame-state","maximized")}hide(e=null){let t=e||this.container;if(!t)throw Error("Frame element is not started or not found");t.style.display="none",sessionStorage.setItem("frame-state","hide")}minimizeOrMaximize(e=null){var t=e||this.container,e=sessionStorage.getItem("frame-state");if(!t)throw Error("Frame element is not started or not found");switch(e){case"minimized":this.maximize();break;case"maximized":this.minimize();break;default:this.maximize()}}minimize(e=null){let i=e||this.container;if(!i)throw Error("Frame element is not started or not found");this.fenixHeader?(i.style.cssText+="height: 65px !important; width: 65px !important;",i.style.borderRadius="50px",this.fenixHeader.style.paddingTop="10px",this.fenixHeader.style.paddingRight="5px",this.fenixHeader.style.height="70px",this.closeHeader.style.display="block",this.chatIcon.style.display="block"):this.styleToMinimize&&Object.keys(this.styleToMinimize).forEach((e,t)=>{i.style.cssText+=`${e}: ${this.styleToMinimize[e]} !important`}),this.sendActionToChangeState("minimize"),sessionStorage.setItem("frame-state","minimized")}maximize(e=null){let i=e||this.container,n=this;if(!i)throw Error("Frame element is not started or not found");i.style.display="block",this.fenixHeader&&(this.fenixHeader.style.paddingTop="0",this.fenixHeader.style.paddingRight="0",this.fenixHeader.style.height="10px",this.closeHeader.style.display="block",this.chatIcon.style.display="none"),this.currentStyle&&(i.style.borderRadius="0",Object.keys(n.currentStyle).forEach(function(e,t){i.style[e]=n.currentStyle[e]})),this.styleToMaximize&&Object.keys(this.styleToMaximize).forEach((e,t)=>{i.style.cssText+=`${e}: ${this.styleToMaximize[e]} !important`}),this.sendActionToChangeState("maximize"),sessionStorage.setItem("frame-state","maximized")}toggle(e=null){e=e||this.container;if(!e)throw Error("Frame element is not started or not found");"block"==e.style.display?this.hide():this.display()}addClass(e){let t=this.container;if(!t)throw Error("Frame element is not started or not found");for(var i of e)t.classList.add(i)}addId(e){let t=this.container;if(!t)throw Error("Frame element is not started or not found");t.setAttribute("id",e)}frameState(){if(!this.container)throw Error("Frame element is not started or not found");switch(sessionStorage.getItem("frame-state")){case"minimized":this.minimize();break;case"maximized":this.maximize();break;default:this.hide()}}createContainer(e,t){e||console.warn("Frame is being created beacause was not found");let i=e&&document.querySelector(e)?document.querySelector(e):document.createElement("div"),n=document.createElement("iframe"),s=document.createElement("div");s.appendChild(n),i.appendChild(s),document.body.appendChild(i),this.container=i,this.bodyDiv=s,this.frame=n,this.addClass(["chat-fenix-container"]),s.setAttribute("class","chat-fenix-iframe-div"),s.style.width="100%",s.style.height="100%",(this.headerIsActive=t)&&!document.querySelector(e)?(n.style.height="calc(100% - 10px)",this.createHeaderDiv()):n.style.height="100%"}createHeaderDiv(){if(!this.container)throw Error("Frame element is not started or not found");{let e=document.createElement("div"),t=this.container,i=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div");var o=document.createElement("span");let r=document.createElement("div");e.appendChild(r),n.appendChild(s),n.appendChild(o),i.appendChild(n),e.appendChild(i),i.setAttribute("class","chat-fenix-chat-icon"),n.setAttribute("class","chat-fenix-icon-wrp"),s.setAttribute("class","chat-fenix-icon"),e.setAttribute("class","chat-fenix-header"),r.setAttribute("class","chat-fenix-close-header"),t.insertBefore(e,t.childNodes[0]),this.fenixHeader=e,this.chatIcon=i,this.closeHeader=r,e.addEventListener("click",()=>{this.minimizeOrMaximize()},!1)}}headerStyle(e){var t=this.container;let i=this.fenixHeader;t&&this.headerIsActive?e&&(t=e.headerStartColor||"#fff",e=e.headerEndColor||"#fff",i.style.background=`linear-gradient(to right, ${t} 4%, ${e} 100%)`):console.warn("Header is not active or not found")}sendActionToChangeState(e){this.frame.contentWindow.postMessage({action:e},"*")}sendMessage(e=null,t=null){t={queueId:e,subjectId:t,endpoint:window.location.href,token:this.token};this.frame.contentWindow.postMessage(t,"*")}onMinimize(e){if("object"!=typeof e)throw Error(`Método ( onMinimize ) espera parâmetro do tipo ( object ) recebeu ( ${typeof e} )`);this.styleToMinimize=e}onMaximize(e){if("object"!=typeof e)throw Error(`Método ( onMaximize ) espera parâmetro do tipo ( object ) recebeu ( ${typeof e} )`);this.styleToMaximize=e}on(t,i){this.events.forEach(e=>{e.setCallbackListener(t,i)})}}class EventListener{constructor(e){this.event=e,this.listeners=new Array,window.addEventListener("message",e=>{e&&e.data&&e.data==this.event&&this.execute()})}setCallbackListener(e,t){this.event==e&&this.listeners.push(t)}getEvent(){return this.event}execute(){this.listeners.forEach(e=>{e()})}}